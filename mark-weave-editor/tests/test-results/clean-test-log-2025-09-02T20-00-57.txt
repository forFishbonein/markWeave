CRDT Test Results - Clean Version
Generated at: 9/3/2025, 4:00:57 AM
================================


> mark-weave-editor@0.1.0 test:crdt
> jest --runInBand --verbose

    ================================================================================


    ğŸš€ CRDT Performance Benchmark Test Suite - benchmark.test.js


    ================================================================================


    --- CRDT Benchmark Result ---


    Total operations: 900


    Time elapsed (ms): 2475.78


    Operations / ms: 0.36


    Final text length: 471


    First 120 chars of text: ppuetrxqnzhpypaxzwwictqaltfsqwtelcfktdytsaluomopyejtbvxfymnczwtamgmpmjyddxyuirfhftnybfbrclbbtuejeuyolvccehmtrljnehhdzgbl


    ================================================================================


    ğŸ² CRDT Randomized Fuzz Test Suite - fuzz.test.js


    ================================================================================


    ğŸ¯ Starting 50 rounds of random operation test...


    âœ… 50 rounds of random operation test completed


    ğŸ”€ Starting complex mixed operation test (30 rounds)...


    âœ… Complex mixed operation test completed


    âš¡ Starting extreme boundary case test (25 rounds)...


    âœ… Extreme boundary case test completed


    â° Starting timestamp conflict stress test (20 rounds)...


    âœ… Timestamp conflict stress test completed


    ğŸŒ Starting network partition recovery test (15 rounds)...


    âœ… Network partition recovery test completed


    ğŸ“Š Starting large data volume test (10 rounds)...


    âœ… Large data volume test completed


    ================================================================================


    âš¡ CRDT Concurrent Operations Test Suite - concurrent.test.js


    ================================================================================


    [SCENARIO] Basic concurrent insert - two clients insert at start


    [SCENARIO] Two clients insert different chars at start


    Base document: hello


    A inserted char "A" opId: 1756843257469@client


    B inserted char "B" opId: 1756843257469@client


    [RESULT] Final: "helloBA"


    [SCENARIO] Concurrent insert in middle - insert at specified char


    ğŸ”§ A client ychars initial length: 0


    ğŸ”§ A length after insertion: 9


    ğŸ”§ A snapshot: start_end


    ğŸ”§ A char details:


    ğŸ”§ B sync length: 9


    ğŸ”§ B snapshot: start_end


    ğŸ“‹ Test scenario: two clients insert after underscore


    Base document: start_end


    ğŸ” Debug char search:


    Char array length: 9


    Underscore "_" opId: 1756843257472_5@client


    State after insertion:


    A: start_Xend


    B: start_Yend


    [RESULT] Final: "start_YXend"


    âœ… Characters inserted correctly after underscore


    [SCENARIO] Multiple character concurrent insert - using insertText


    Base document: base


    A after insertion: AAAbase


    B after insertion: BBBbase


    [RESULT] Final: "BBBAAAbase"


    [SCENARIO] Three client concurrent insert - complex concurrent scenario


    Base document: start


    State after insertion:


    A: start1


    B: start2


    C: start3


    ğŸ¯ Final result:


    A: start312


    B: start312


    C: start312


    âœ… Characters inserted at document end (modified behavior)


    [SCENARIO] Simulate two users fast continuous input


    Base document: doc


    After fast typing:


    A: doc_end


    B: doc!


    [RESULT] Final: "doc_end!"


    [ANALYSIS] Result: "doc_end!"


    âœ… Characters inserted in reasonable order (A before B)


    [SCENARIO] Mixed concurrent operations - A insert, B delete


    Base document: hello world


    After operation:


    A: hello worldX


    B: helloorld


    [RESULT] Final: "helloorldX"


    === Visible characters after mixed operations ===


    [0] "h" -> opId: 1756843257489_0@client (timestamp: 1756843257489_0)


    [1] "e" -> opId: 1756843257489_1@client (timestamp: 1756843257489_1)


    [2] "l" -> opId: 1756843257489_2@client (timestamp: 1756843257489_2)


    [3] "l" -> opId: 1756843257489_3@client (timestamp: 1756843257489_3)


    [4] "o" -> opId: 1756843257489_4@client (timestamp: 1756843257489_4)


    [5] "o" -> opId: 1756843257489_7@client (timestamp: 1756843257489_7)


    [6] "r" -> opId: 1756843257489_8@client (timestamp: 1756843257489_8)


    [7] "l" -> opId: 1756843257489_9@client (timestamp: 1756843257489_9)


    [8] "d" -> opId: 1756843257489_10@client (timestamp: 1756843257489_10)


    [9] "X" -> opId: 1756843257489@client (timestamp: 1756843257489)


    Actual result analysis: "helloorldX"


    âœ… Deletion operation took effect, deleted 'w ' character


    âœ… Deletion operation took effect, deleted 'o' related characters


    [SCENARIO] Concurrent insert on empty document


    After insertion:


    A: A


    B: B


    [RESULT] Empty document concurrent insertion result: "AB"


    Result length: 2


    [SCENARIO] Deep analysis of timestamps and sorting rules


    Timestamp analysis:


      Start time: 1756843257499


      Middle time: 1756843257499 (difference: 0ms)


      End time: 1756843257499 (difference: 0ms)


    Actual opId:


      A opId: 1756843257499@client


      B opId: 1756843257499@client


    [ORDER] Expected: Sort by timestamp, Actual: T1T2


    Char "T1" timestamp: 1756843257499


    Char "T2" timestamp: 1756843257499


    [RESULT] Final order: "T1T2"


    [SCENARIO] Three client ultra-fast concurrent insert


    ğŸ” baseChars length: 4


    ğŸ” baseChars: [
      { ch: 'b', opId: '1756843257502_0@client' },
      { ch: 'a', opId: '1756843257502_1@client' },
      { ch: 's', opId: '1756843257502_2@client' },
      { ch: 'e', opId: '1756843257502_3@client' }
    ]


    ğŸ” lastCharId: 1756843257502_3@client


    State after ultra-fast insertion:


    A: baseA4A3A2A1A0


    B: baseB4B3B2B1B0


    C: baseC4C3C2C1C0


    ğŸ¯ Ultra-fast concurrent final result:


    A: baseA4A3A2A1A0C4C3C2C1C0B4B3B2B1B0


    B: baseA4A3A2A1A0C4C3C2C1C0B4B3B2B1B0


    C: baseA4A3A2A1A0C4C3C2C1C0B4B3B2B1B0


    [SCENARIO] Simulate network partition and delayed sync


    After A-B sync during partition:


    A-B state: start12


    C isolated state: startisolated


    Before network recovery:


    A-B: _partitioned_networkstart12


    C: startisolated


    ğŸ¯ Final state after network recovery:


    A: _partitioned_networkstartisolated12


    B: _partitioned_networkstartisolated12


    C: _partitioned_networkstartisolated12


    [SCENARIO] Large-scale concurrent pressure test - 10 clients


    Base document: shared_document


    Performed 30 concurrent operations


    ğŸ¯ Large-scale concurrent final result:


    Final document: _3_2_3_0_6_2_6_0_7_27_0_0_2_0__4_2_4_0_2_2__0_8_2_8_0_1_2_1_0_9_2_9__5_2_5_0haredment


    Document length: 85


    [SCENARIO] Out-of-order message sync test


    Simulate out-of-order sync...


    ğŸ¯ Out-of-order sync final result:


    A: B2B1C1A2A1


    B: B2B1C1A2A1


    C: B2B1C1A2A1


    [SCENARIO] Conflict resolution for same timestamp


    Created operations with same timestamp


    ğŸ¯ Conflict resolution result for same timestamp: AB


    [SCENARIO] Simulate network packet loss and message loss


    Generated 4 updates


    Delivery after packet loss:


    A received: 1 updates


    B received: 0 updates


    C received: 1 updates


    State after packet loss:


    A: base143


    B: base2


    C: base13


    ğŸ¯ Final state after network recovery:


    A: base2143


    B: base2143


    C: base2143


    [SCENARIO] Simulate different network delays


    Simulate transmission in order of delay:


    Step 1: C -> [A, B] (delay 50ms)


       State: A="startAC", B="startBC", C="startC"


    Step 2: A -> [B, C] (delay 100ms)


       State: A="startAC", B="startBAC", C="startAC"


    Step 3: B -> [A, C] (delay 300ms)


       State: A="startBAC", B="startBAC", C="startBAC"


    ğŸ¯ Final result of delay simulation:


    A: startBAC


    B: startBAC


    C: startBAC


    [SCENARIO] Simulate network duplicate transmission


    Original state: original


    B after adding X: originalX


    A first update received: originalX


    Simulate duplicate transmission of the same update...


    After 2 applications: originalX


    After 3 applications: originalX


    After 4 applications: originalX


    After 5 applications: originalX


    After 6 applications: originalX


    ğŸ¯ Duplicate transmission handling result:


    A: originalX


    B: originalX


    [SCENARIO] Simulate network bandwidth limit and batch transmission


    Generated 20 individual updates


    A current state: 01234567890123456789


    Split into 4 batches for transmission


    Transmitting batch 1/4 (5 updates)


    State after batch 1: 01234


    Transmitting batch 2/4 (5 updates)


    State after batch 2: 0123456789


    Transmitting batch 3/4 (5 updates)


    State after batch 3: 012345678901234


    Transmitting batch 4/4 (5 updates)


    State after batch 4: 01234567890123456789


    ğŸ¯ Final result of batch transmission:


    A: 01234567890123456789


    B: 01234567890123456789


    ================================================================================


    ğŸ”„ CRDT Conflict Resolution Test Suite - removeWins.test.js


    ================================================================================


    ğŸ“‹ Test Scenario: remove-wins conflict resolution mechanism


    Initial text: hi


    Character IDs: { hId: '1756843257617_0@client', iId: '1756843257618_1@client' }


    C2 after sync: hi


    C1 bold operation completed, C2 synced


    C2 remove bold operation completed, C1 synced


    C1 format operation count: 2


    C2 format operation count: 2


    Format operation types: [ 'addMark-bold', 'removeMark-bold' ]


    ğŸ”¥ convertCRDTToProseMirrorDoc called


    the newest yformatOps:  []


    the newest ychars []


    âœ… Generated paragraph: []


    ğŸ“„ ProseMirror document structure:


    {
      "type": "doc",
      "content": [
        {
          "type": "paragraph"
        }
      ]
    }


    âš ï¸ Document is empty, which matches remove-wins logic


    ================================================================================


    ğŸ¨ CRDT Multi-Format Test Suite - multiMark.test.js


    ================================================================================


    ğŸ“‹ Test scenario: Nested formatting - bold containing italic


    Initial text: Hello World


    Character ranges:


      Hello range: 1756843257699_0@client to 1756843257700_4@client


      World range: 1756843257700_6@client to 1756843257700_10@client


    ğŸ”¸ A operation: Bold entire 'Hello World'


    ğŸ”¸ B operation: Add italic to 'World' part


    ğŸ”„ Synchronizing format operations...


    Final format operations count: 2


    Format operation details:


      1. addMark em (1756843257701@client)


      2. addMark bold (1756843257701@client)


    ğŸ“„ ğŸ¯ Nested formatting final result:


      Plain text: "Hello World"


      Format operations count: 2


      Formatted text: [H:bold][e:bold][l:bold][l:bold][o:bold][ :bold][W:em,bold][o:em,bold][r:em,bold][l:em,bold][d:em,bold]


      Format operation details:


        1. addMark em (1756843257701@client)


        2. addMark bold (1756843257701@client)




    Expected effect: 'Hello World' all bold, 'World' part also italic


    ğŸ“‹ Test scenario: Cross formatting - A bolds ABC, B italicizes DEF, C has both bold and italic


    Initial text: ABCDEF


    Character ID mapping:


      A(0): 1756843257707_0@client


      B(1): 1756843257707_1@client


      C(2): 1756843257707_2@client


      D(3): 1756843257707_3@client


      E(4): 1756843257707_4@client


      F(5): 1756843257707_5@client


    ğŸ”¸ A operation: Bold 'ABC' (positions 0-2)


    ğŸ”¸ B operation: Add italic to 'DEF' (positions 3-5)


    ğŸ”„ Concurrent sync of A and B formatting operations...


    ğŸ”¸ C operation: Apply both bold and italic to 'CD' (positions 2-3)


    ğŸ”„ Three-way sync of all formatting operations...


    Final format operations total: 4


    Bold operations: 2 count


    Italic operations: 2 count


    Expected format distribution:


      A: bold, B: bold, C: bold+italic, D: italic+bold, E: italic, F: italic


    ğŸ“„ ğŸ¯ Cross formatting final result:


      Plain text: "ABCDEF"


      Format operations count: 4


      Formatted text: [A:bold][B:bold][C:bold,em][D:em,bold][E:em][F:em]


      Format operation details:


        1. addMark em (1756843257709@client)


        2. addMark bold (1756843257709@client)


        3. addMark bold (1756843257710@client)


        4. addMark em (1756843257710@client)




    ğŸ“‹ Test scenario: remove-wins priority - multi-client format conflicts


    ğŸ¯ remove-wins final result: test


    Format operation statistics:


    Add operations: 3


    Remove operations: 1


    ğŸ“‹ Test scenario: Chain format operations


    Initial paragraph: This is a complex paragraph for testing.


    Target word positions:


      'This' (0-3): 1756843257718_0@client to 1756843257718_3@client


      'complex' (10-16): 1756843257718_10@client to 1756843257718_16@client


      'testing' (31-37): 1756843257718_31@client to 1756843257720_37@client


    ğŸ”¸ A's format operations:


      1. Bold 'This'


      2. Add italic to 'complex'


      3. Add link to 'testing'


    ğŸ”¸ B's format operations:


      1. Bold 'complex' (overlapped with A's italic)


      2. Add italic to 'This' (overlapped with A's bold)


    ğŸ”„ First round sync of format operations...


    After first round: This is a complex paragraph for testing.


    Number of format operations after first round: 5


    ğŸ”¸ Second round operations - undo some formats:


      A: Undo bold for 'This'


      B: Undo italic for 'complex'


    ğŸ”„ Final sync of all operations...


    Total number of format operations: 7


    Types of formats involved: [ 'bold', 'em', 'link' ]


    Add operations: 5 , Remove operations: 2


    Expected final effect:


      'This': Only italic (bold removed)


      'complex': Only bold (italic removed)


      'testing': Has link


    ğŸ“„ ğŸ¯ Chain format final result:


      Plain text: "This is a complex paragraph for testing."


      Format operations count: 7


      Formatted text: [T:em][h:em][i:em][s:em] is a [c:bold][o:bold][m:bold][p:bold][l:bold][e:bold][x:bold] paragraph for[ :link][t:link][e:link][s:link][t:link][i:link][n:link]g.


      Format operation details:


        1. addMark bold (1756843257723@client)


        2. addMark em (1756843257723@client)


        3. addMark bold (1756843257722@client)


        4. addMark em (1756843257722@client)


        5. addMark link (1756843257723@client)


        6. removeMark em (1756843257725@client)


        7. removeMark bold (1756843257725@client)




    ğŸ“‹ Test scenario: Boundary formatting - single character formatting


    ğŸ“„ ğŸ¯ Boundary formatting result:


      Plain text: "XY"


      Format operations count: 3


      Formatted text: [X:bold,em,link]Y


      Format operation details:


        1. addMark bold (1756843257732@client)


        2. addMark em (1756843257732@client)


        3. addMark link (1756843257732@client)




    ğŸ“‹ Test scenario: Concurrent formatting and text editing mixed


    Status of each client after mixed operations:


    A (inserted): eding_tit


    B (formatted): edit


    C (deleted+formatted): edt


    ğŸ¯ Mixed scenario final result:


    A: eding_tt


    B: eding_tt


    C: eding_tt


    ================================================================================


    ğŸ¯ CRDT Deterministic Test Suite - deterministic.test.js


    ================================================================================


    ğŸ“‹ Test scenario: two clients concurrently insert text


    Status after insertion:


    A: abc


    B: XYZ


    ğŸ¯ Final result after synchronization:


    A: XYZabc


    B: XYZabc


    âœ… State consistency verification: Passed


